<project basedir="." default="..." name="wonderland.run-sgs">
    <dirname property="imported.basedir" file="${ant.file.build-setup}"/>
    
    <target name="setup-sgs">
        <delete dir="${sgs.db.dir}" failonerror="false"/>
        <mkdir dir="${sgs.db.dir}"/>
        
        <copy file="src/darkstar_config/WonderlandMain.cfg" todir="${sgs.javaext.dir}/" overwrite="true">
            <filterset>
                <filter token="SGS_ROOT_DIR" value="${sgs.root.dir}"/>
                <filter token="SGS_PORT" value="${sgs.port}"/>
                <filter token="VOICE_ENABLED" value="${voicelib-filter}"/>
            </filterset>            
        </copy>
    </target>

    <target name="run-sgs" depends="jar-server,setup-sgs,modules-server-classpath" description="Run Sun Game Server for Project Wonderland">
        <copy file="sgs-logging.properties" todir="ext/sgs/darkstar" failonerror="false"/>
        <java classname="com.sun.sgs.impl.kernel.Kernel" fork="true">
            <jvmarg value="-Djava.library.path=${sgs.javaext.dir}/lib/bdb/${sgs.platform.lib}"/>
            <jvmarg value="-Djava.util.logging.config.file=${sgs.javaext.dir}/sgs-logging.properties"/>
            <jvmarg value="-Dcom.sun.sgs.config.file=${sgs.javaext.dir}/sgs-config.properties"/>
            <jvmarg value="-Dcom.sun.sgs.impl.kernel.Kernel.profile.level=on"/>
            <jvmarg value="-Dcom.sun.sgs.impl.service.voice.watchdog.timeout=${voiceservice.watchdog.timeout}"/>
            <jvmarg value="-Dcom.sun.sgs.impl.service.voice.bridge.ping.timeout=${voiceservice.bridge.ping.timeout}"/>
            <jvmarg value="-Dcom.sun.sgs.txn.timeout=1000"/>

            <classpath>
		<pathelement path="${wonderland-server.classpath}"/>
                <pathelement location="ext/sgs/darkstar/lib/listener.jar"/>
                <pathelement path="${module-server.classpath}"/>
            </classpath>
            <!-- <jvmarg value="-agentlib:yjpagent"/> -->
	    <env key="${env.path.name}" path="${env.path.defvalue}"/>
	    <syspropertyset refid="wonderland.properties"/>
            <arg value="${sgs.javaext.dir}/WonderlandMain.cfg"/>
        </java>
    </target>
    
    <target name="debug-sgs" depends="jar-server,setup-sgs,modules-server-classpath" description="Debug Sun Game Server for Project Wonderland" >
        <copy file="sgs-logging.properties" todir="ext/sgs/darkstar" failonerror="false"/>
        <nbjpdastart addressproperty="jpda.address" name="lg3d-wonderland" transport="dt_socket">
            <classpath>
		<!--<pathelement path="${wonderland-client.classpath}"/>-->
                <pathelement path="${wonderland-server.classpath}"/>
                <pathelement location="ext/sgs/darkstar/lib/listener.jar"/>
                <pathelement path="${module-server.classpath}"/>
            </classpath>
        </nbjpdastart>

        <java classname="com.sun.sgs.impl.kernel.Kernel" fork="true">
            <jvmarg value="-Djava.library.path=${sgs.javaext.dir}/lib/bdb/${sgs.platform.lib}"/>
            <jvmarg value="-Djava.util.logging.config.file=${sgs.javaext.dir}/sgs-logging.properties"/>
            <jvmarg value="-Dcom.sun.sgs.config.file=${sgs.javaext.dir}/sgs-config.properties"/>
            <jvmarg value="-Dcom.sun.sgs.impl.kernel.Kernel.profile.level=on"/>
            <jvmarg value="-Dcom.sun.sgs.impl.service.voice.watchdog.timeout=${voiceservice.watchdog.timeout}"/>
            <jvmarg value="-Dcom.sun.sgs.impl.service.voice.bridge.ping.timeout=${voiceservice.bridge.ping.timeout}"/>
            <jvmarg value="-Dcom.sun.sgs.txn.timeout=100000000"/>

            <classpath>
		<pathelement path="${wonderland-server.classpath}"/>
                <pathelement location="ext/sgs/darkstar/lib/listener.jar"/>
                <pathelement path="${module-server.classpath}"/>
            </classpath>

	    <env key="${env.path.name}" path="${env.path.defvalue}"/>
	    <syspropertyset refid="wonderland.properties"/>
            <arg value="${sgs.javaext.dir}/WonderlandMain.cfg"/>

            <!--start debug-->
            <jvmarg value="-Xdebug"/>
            <jvmarg value="-Xnoagent"/>
            <jvmarg value="-Djava.compiler=none"/>
            <jvmarg value="-Xrunjdwp:transport=dt_socket,address=${jpda.address}"/>
            <!--end debug-->

	</java>
    </target>
</project>
