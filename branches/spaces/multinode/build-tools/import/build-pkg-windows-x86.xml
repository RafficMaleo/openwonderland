<project basedir="." default="..." name="wonderland.build-pkg-windows-x86">
    <dirname property="imported.basedir" file="${ant.file.build-pkg-windows-x86}"/>

    <property name="release.nsis.dir" location="${release.dir}/nsis"/>
    <property name="stage.nsis.dir" location="${release.nsis.dir}/stage"/>

    <!-- license filename -->
    <property name="license.file" location="${release.platform.dir}/ALL-LICENSES.txt"/>

    <!-- to execute this you have to have makensis in PATH variable
	 due to paths for NSIS works correctly on windows machine only -->
    <target name="pkg-platform" depends="pkg-stage" description="Create Windows installer">
        <mkdir dir="${release.nsis.dir}"/>

	<copy todir="${stage.nsis.dir}">
	    <fileset dir="${release.platform.dir}"
			includes="**/*" excludes="**/*-bundle-readme.txt"/>
	    <fileset file="${build-nsis.dir}/Wonderland.ico"/>
	</copy>

        <!-- prepare NSIS script -->
        <copy file="${build-nsis.dir}/lg3d-wonderland.nsi.template"
	      tofile="${release.nsis.dir}/lg3d-wonderland.nsi" overwrite="true">
            <filterset>
                <filter token="RELEASE_DIR" value="${stage.nsis.dir}"/>
                <filter token="LG3D_RELEASE" value="${release.pkg.dir}"/>
                <filter token="LG3D_INSTALL" value="${release.pkg.basename}"/>
                <filter token="LG3D_VERSION" value="${build.version}"/>
                <filter token="LG3D_LICENSE" value="${license.file}"/>
                <filter token="LG3D_ICONFILE" value="Wonderland.ico"/>
            </filterset>
	</copy>

        <!-- create installer -->
        <exec executable="${makensis.path}" failonerror="true">
            <arg file="${release.nsis.dir}/lg3d-wonderland.nsi" />
        </exec>
    </target>

    <target name="pkg-platform-clean">
	<echo message="******** ${release.nsis.dir}"/>
	<delete dir="${release.nsis.dir}"/>
    </target>
</project>
