<project basedir="." default="..." name="wonderland.run-voice">
    <dirname property="imported.basedir" file="${ant.file.build-setup}"/>

    <target name="shutdown_bridge" description="Shutdown Conference Bridge">
        <java classname="com.sun.voip.server.ShutdownBridge" failonerror="true" fork="true">
            <classpath>
                <pathelement location="${voicebridge.dir}/bridge.jar"/>
            </classpath>
        </java>
    </target>

    <target name="run-bridge" depends="unpack-audio-jar" description="Conference Bridge">
        <java classname="com.sun.voip.server.Bridge" failonerror="true" fork="true">
            <jvmarg value="${voice.vm}"/>
	    <!--  see the documentation of gov.nist.jain.protocol.ip.sip.SipStackImpl for
		  explanations and other configuration switches. 
	     -->
	    <jvmarg value="-Dgov.nist.jainsip.stack.disableAuthentication=true"/>
	    <jvmarg value="-Dgov.nist.jainsip.stack.traceLevel=8"/>
	    <jvmarg value="-Dgov.nist.jainsip.stack.enableUDP=${voicebridge.sip.port}"/>
	    <jvmarg value="-Dgov.nist.javax.sip.SERVER_LOG=sipMessages.log"/>
	    <jvmarg value="-Dgov.nist.javax.sip.DEBUG_LOG=nistStack.log"/>
	    <jvmarg value="-Dcom.sun.voip.server.BRIDGE_LOG=bridge.log"/>
	    <jvmarg value="-Dcom.sun.voip.server.BRIDGE_LOCATION=LOC"/>
	    <jvmarg value="-Dcom.sun.voip.server.MODULES_PATH=${voicebridge.dir}/bridgeModules"/>
	    <jvmarg value="-Dcom.sun.voip.server.LOCALHOST_SECURITY=false"/>
            <jvmarg value="-Dcom.sun.voip.server.Bridge.soundPath=/com/sun/voip/server/sounds:."/>
            <jvmarg value="-Dcom.sun.voip.server.BRIDGE_CONTROL_PORT=${voicebridge.control.port}"/>
            <jvmarg value="-Dcom.sun.voip.server.PUBLIC_IP_ADDRESS=${voicebridge.server.public.address}"/>
            <jvmarg value="-Dcom.sun.voip.server.BRIDGE_PUBLIC_CONTROL_PORT=${voicebridge.server.public.control.port}"/>
            <jvmarg value="-Dcom.sun.voip.server.PUBLIC_SIP_PORT=${voicebridge.server.public.sip.port}"/>
            <jvmarg value="-Dcom.sun.voip.server.FIRST_RTP_PORT=${voicebridge.first.rtp.port}"/>
            <jvmarg value="-Dcom.sun.voip.server.LAST_RTP_PORT=${voicebridge.last.rtp.port}"/>
            <jvmarg value="-Dcom.sun.voip.server.BRIDGE_STATUS_LISTENERS=${sgs.server}:6668"/>
	    <jvmarg value="-Djavax.sip.IP_ADDRESS=${wonderland.local.hostAddress}"/>
            <jvmarg value="-ms200m"/>
            <jvmarg value="-mx200m"/>
	    <jvmarg value="-XX:NewSize=10m"/>
            <jvmarg value="-XX:MaxNewSize=10m"/> 
            <jvmarg value="-XX:+UseParNewGC"/> 
            <jvmarg value="-XX:+UseConcMarkSweepGC"/> 
            <jvmarg value="-XX:+PrintClassHistogram"/> 
            <jvmarg value="-XX:+PrintGCDetails"/>
            <jvmarg value="-XX:+PrintGCTimeStamps"/>

            <jvmarg value="-XX:+TraceGen0Time"/>
            <jvmarg value="-XX:+TraceGen1Time"/>

            <arg value="noprogram"/>
           <classpath>
                <pathelement location="${voicebridge.dir}/bridge.jar"/>
                <pathelement location="${voicebridge.dir}/codecLib_dtmf.jar"/>
                <pathelement location="${voicebridge.dir}/codecLibwrapper_dtmf.jar"/>
        	<pathelement location="${voicebridge.dir}/jspeex.jar"/>
        	<pathelement location="${voicebridge.dir}/log4j-1.2.8.jar"/>
                <pathelement location="${voicebridge.dir}/nist-sip/JainSipRi1.2.jar"/>
                <pathelement location="${voicebridge.dir}/nist-sip/JainSipApi1.2.jar"/>
                <pathelement location="${voicebridge.dir}/nist-sip/concurrent.jar"/>
                <pathelement location="${voicebridge.dir}/voip.jar"/>
            </classpath>
        </java>
    </target>

    <target name="run-softphone" description="Software Phone">
        <java classname="com.sun.mc.softphone.SipCommunicator" failonerror="true" fork="true">
            <jvmarg value="${voice.vm}"/>
            <jvmarg value="-ms200m"/>
            <jvmarg value="-mx200m"/>
	    <jvmarg value="-XX:NewSize=5m"/>
            <jvmarg value="-XX:MaxNewSize=5m"/> 
            <jvmarg value="-XX:+UseParNewGC"/> 
            <jvmarg value="-XX:+UseConcMarkSweepGC"/> 

           <classpath>
                <pathelement location="${voicebridge.dir}/softphone.jar"/>
            </classpath>
        </java>
    </target>

</project>
